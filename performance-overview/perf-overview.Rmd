Performance Overview
====================

In order to give a brief intuition of the current state of self-optimizing
interpreters compared to other language implementations, we briefly compare 
the performance of a set of classic benchmarks for Java, C, JRuby, and the SOM
implementations.

Note, for the moment, the benchmark set is not yet complete for all languages.

```{r echo=FALSE, message=FALSE, warning=FALSE, results='hide', errors=FALSE}
# load libraries, the data, and prepare it
if (Sys.getenv("RSTUDIO") == "1") { setwd("/Users/smarr/Projects/PostDoc/SELF-OPT-INT/performance-overview") }

source("../scripts/libraries.R", chdir=TRUE)
data <- load_data_file("perf-overview.data")
data <- subset(data, select = c(Value, Unit, Benchmark, VM, Suite))
data <- prepare_vm_names(data)
steady <- droplevels(subset(data, grepl("steady", Suite)))
```


Overall Performance
-------------------

As a first, and misleading impression, an aggregated overview over the results
in form of a simple bar chart:

**TODO** add proper error bars, and read up on effect size confidence intervals.

```{r echo=FALSE, fig.width=6, fig.height=4, dev='svg'}
# aggregate results for display
stats <- ddply(steady, ~ Benchmark + VM + Suite,
               summarise,
               Time.mean                 = mean(Value),
               Time.geomean              = geometric.mean(Value),
               Time.stddev               = sd(Value),
               Time.median               = median(Value),
               max = max(Value),
               min = min(Value))

# normalize for each benchmark separately to the Java baseline
norm <- ddply(stats, ~ Benchmark, transform,
              RuntimeRatio = Time.mean / Time.mean[VM == "Java8"])

# summarize to VMs
vms <- ddply(norm, ~ VM,
             summarise,
             RunRatio.geomean = geometric.mean(RuntimeRatio))

# create a simple bar chart
plot <- ggplot(vms, aes_string(x="VM", y="RunRatio.geomean"))
plot <- plot + geom_bar(stat="identity",
                   colour=get_color(5, 6),
                   size=.3,        # Thinner lines
                   fill=get_color(5, 7),
                   width=0.75) +
    scale_y_continuous(limit=c(0,10), breaks=seq(0,100,1), expand = c(0,0)) + 
    ylab("Runtime, normalized to Java8\nlower is better") +
    theme_bw() + theme_simple() + theme(axis.text.x = element_text(angle= 90, vjust=0.5, hjust=1))
  plot
```

```{r echo=FALSE, fig.width=6, fig.height=4, dev='svg'}
 plot <- ggplot(norm, aes(x=VM, y=RuntimeRatio)) +
  geom_hline(aes(yintercept=(c(1, 10))), colour="#cccccc", linetype="dashed") +
  
  geom_boxplot(fill=get_color(5, 7)) + theme_bw() + theme_simple() + theme(axis.text.x = element_text(angle= 90, vjust=0.5, hjust=1)) +
  scale_y_continuous(limit=c(0,35), breaks=seq(0,100,5), expand = c(0,0)) + 
  ylab("Runtime, normalized to Java8\nlower is better")
 plot
```

```{r echo=FALSE, fig.width=7, fig.height=5, dev='svg'}
# create a simple bar chart
plot <- ggplot(norm, aes_string(x="VM", y="RuntimeRatio"))
plot <- plot + geom_bar(stat="identity",
                   colour=get_color(5, 6),
                   size=.3,        # Thinner lines
                   fill=get_color(5, 7),
                   width=0.75) +
  scale_y_continuous(limit=c(0,35),
                                                    breaks=seq(0,100,5),
                                                    expand = c(0,0)) +
  ylab("Runtime, normalized to Java (lower is better)")
plot <- plot + facet_wrap(~ Benchmark)
plot <- plot +
    theme_bw() + theme_simple() +
    theme(axis.text.x          = element_text(angle= 90, vjust=0.5, hjust=1))
  plot

```

```{r echo=FALSE, results='asis'}
writeLines("<div class='full center'>")
t <- tabular(Justify(l,data=l)*VM ~ Format(digits=2)*Heading('Runtime in ms')*Benchmark*Heading()*Value*Justify(data=r)*(mean + sd),  data=droplevels(steady))
html(t)
writeLines("</div>")
```




TODO
====

**TODO:**
 - Language Implementations:
    - LuaJIT 2
    - JRuby
    - SOM (RTruffleSOM, TruffleSOM, SOM++, CSOM, SOM (java))

 - some info on Benchmarks:
    - Mandelbrot (represents numerical performance)
    - Delta Blue (represents OO programs)
    - Richards   (represents OO programs)

